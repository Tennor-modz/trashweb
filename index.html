<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Trashcore Chat</title>
  <style>
    body { font-family: Arial, sans-serif; background:black; color:white; text-align:center; }
    .card { background:#111; padding:20px; margin:20px auto; border-radius:10px; width:80%; max-width:500px; }
    input, button { padding:8px; margin:5px; border-radius:5px; border:none; }
    input { width:70%; }
    button { background:#444; color:white; cursor:pointer; }
    button:hover { background:#666; }
    .hidden { display:none; }
    .chat-messages { background:#222; padding:10px; height:200px; overflow-y:auto; margin:10px 0; text-align:left; }
    #onlineList li, #groupList li { cursor:pointer; padding:4px; }
    #onlineList li:hover, #groupList li:hover { background:#333; }
  </style>
</head>
<body>
  <h1>ðŸ”¥ Trashcore Chat ðŸ”¥</h1>

  <!-- Signup -->
  <div id="signupForm" class="card">
    <h2>Create Account</h2>
    <input type="text" id="signupUsername" placeholder="Username"><br>
    <input type="password" id="signupPassword" placeholder="Password"><br>
    <button onclick="signup()">Sign Up</button>
    <p>Already have an account? <a href="#" onclick="showLogin()">Login</a></p>
  </div>

  <!-- Login -->
  <div id="loginForm" class="card hidden">
    <h2>Login</h2>
    <input type="text" id="loginUsername" placeholder="Username"><br>
    <input type="password" id="loginPassword" placeholder="Password"><br>
    <button onclick="login()">Login</button>
    <p>No account? <a href="#" onclick="showSignup()">Sign Up</a></p>
  </div>

  <!-- Main Content -->
  <div id="mainContent" class="hidden">
    <h2>Welcome, <span id="currentUser"></span>!</h2>
    <button onclick="logout()">Logout</button>

    <!-- Public Chat -->
    <div id="publicChat" class="card">
      <h2>Public Chat</h2>
      <div class="chat-messages" id="publicMessages"></div>
      <input type="text" id="publicInput" placeholder="Type a message">
      <button onclick="sendPublicMessage()">Send</button>
    </div>

    <!-- Online Users -->
    <div id="onlineUsers" class="card">
      <h2>Online Users</h2>
      <ul id="onlineList" style="list-style:none; padding:0;"></ul>
    </div>

    <!-- Private Chat -->
    <div id="privateChat" class="card hidden">
      <h2 id="privateChatTitle">Private Chat</h2>
      <div class="chat-messages" id="privateMessages"></div>
      <input type="text" id="privateInput" placeholder="Type a private message">
      <button onclick="sendPrivateMessage()">Send</button>
    </div>

    <!-- Group Chat -->
    <div id="groupChat" class="card">
      <h2>Group Chats</h2>
      <div>
        <input type="text" id="newGroupName" placeholder="New group name">
        <button onclick="createGroup()">Create</button>
      </div>
      <ul id="groupList" style="list-style:none; padding:0; margin:10px 0; text-align:left;"></ul>
    </div>

    <!-- Active Group -->
    <div id="activeGroupChat" class="card hidden">
      <h2 id="activeGroupTitle">Group Chat</h2>
      <div class="chat-messages" id="groupMessages"></div>
      <input type="text" id="groupInput" placeholder="Type a message">
      <button onclick="sendGroupMessage()">Send</button>
    </div>
  </div>

  <script>
    let users = JSON.parse(localStorage.getItem("users")) || [];
    let onlineUsers = JSON.parse(localStorage.getItem("onlineUsers")) || [];
    let publicMessages = JSON.parse(localStorage.getItem("publicMessages")) || [];
    let privateChats = JSON.parse(localStorage.getItem("privateChats")) || {};
    let groups = JSON.parse(localStorage.getItem("groups")) || [];
    let groupChats = JSON.parse(localStorage.getItem("groupChats")) || {};
    let currentDM = null;
    let currentGroup = null;

    // Signup & Login
    function signup() {
      const username = document.getElementById("signupUsername").value.trim();
      const password = document.getElementById("signupPassword").value;
      if (!username || !password) return alert("Fill all fields");
      if (users.find(u => u.username === username)) return alert("User exists");
      users.push({ username, password });
      localStorage.setItem("users", JSON.stringify(users));
      alert("Account created! Please login.");
      showLogin();
    }
    function login() {
      const username = document.getElementById("loginUsername").value.trim();
      const password = document.getElementById("loginPassword").value;
      const user = users.find(u => u.username === username && u.password === password);
      if (!user) return alert("Invalid login");
      localStorage.setItem("loggedInUser", username);
      if (!onlineUsers.includes(username)) {
        onlineUsers.push(username);
        localStorage.setItem("onlineUsers", JSON.stringify(onlineUsers));
      }
      document.getElementById("currentUser").textContent = username;
      showMainContent();
    }
    function logout() {
      const username = localStorage.getItem("loggedInUser");
      onlineUsers = onlineUsers.filter(u => u !== username);
      localStorage.setItem("onlineUsers", JSON.stringify(onlineUsers));
      localStorage.removeItem("loggedInUser");
      location.reload();
    }

    function showSignup() { document.getElementById("signupForm").classList.remove("hidden"); document.getElementById("loginForm").classList.add("hidden"); }
    function showLogin() { document.getElementById("loginForm").classList.remove("hidden"); document.getElementById("signupForm").classList.add("hidden"); }

    // Main Content
    function showMainContent() {
      document.getElementById("signupForm").classList.add("hidden");
      document.getElementById("loginForm").classList.add("hidden");
      document.getElementById("mainContent").classList.remove("hidden");
      showPublicMessages();
      showOnlineUsers();
      showGroups();
    }

    // Public Chat
    function sendPublicMessage() {
      const text = document.getElementById("publicInput").value.trim();
      if (!text) return;
      const from = localStorage.getItem("loggedInUser");
      publicMessages.push({ from, text, time: new Date().toLocaleTimeString() });
      localStorage.setItem("publicMessages", JSON.stringify(publicMessages));
      document.getElementById("publicInput").value = "";
      showPublicMessages();
    }
    function showPublicMessages() {
      const box = document.getElementById("publicMessages");
      box.innerHTML = "";
      publicMessages.forEach(m => {
        const p = document.createElement("p");
        p.textContent = `[${m.time}] ${m.from}: ${m.text}`;
        box.appendChild(p);
      });
      box.scrollTop = box.scrollHeight;
    }

    // Online Users
    function showOnlineUsers() {
      const list = document.getElementById("onlineList");
      list.innerHTML = "";
      const me = localStorage.getItem("loggedInUser");
      onlineUsers.forEach(u => {
        if (u !== me) {
          const li = document.createElement("li");
          li.textContent = "ðŸŸ¢ " + u;
          li.onclick = () => openPrivateChat(u);
          list.appendChild(li);
        }
      });
    }

    // Private Chat
    function openPrivateChat(user) {
      currentDM = user;
      document.getElementById("privateChat").classList.remove("hidden");
      document.getElementById("privateChatTitle").textContent = "Chat with " + user;
      showPrivateMessages();
    }
    function sendPrivateMessage() {
      if (!currentDM) return;
      const text = document.getElementById("privateInput").value.trim();
      if (!text) return;
      const from = localStorage.getItem("loggedInUser");
      const key = getChatKey(from, currentDM);
      if (!privateChats[key]) privateChats[key] = [];
      privateChats[key].push({ from, text, time: new Date().toLocaleTimeString() });
      localStorage.setItem("privateChats", JSON.stringify(privateChats));
      document.getElementById("privateInput").value = "";
      showPrivateMessages();
    }
    function showPrivateMessages() {
      const box = document.getElementById("privateMessages");
      if (!currentDM) return;
      const me = localStorage.getItem("loggedInUser");
      const key = getChatKey(me, currentDM);
      const msgs = privateChats[key] || [];
      box.innerHTML = "";
      msgs.forEach(m => {
        const p = document.createElement("p");
        p.textContent = `[${m.time}] ${m.from}: ${m.text}`;
        box.appendChild(p);
      });
      box.scrollTop = box.scrollHeight;
    }
    function getChatKey(u1, u2) { return [u1, u2].sort().join("_"); }

    // Group Chat
    function createGroup() {
      const name = document.getElementById("newGroupName").value.trim();
      if (!name) return alert("Enter a group name");
      if (groups.includes(name)) return alert("Group exists");
      groups.push(name);
      localStorage.setItem("groups", JSON.stringify(groups));
      document.getElementById("newGroupName").value = "";
      showGroups();
    }
    function showGroups() {
      const list = document.getElementById("groupList");
      list.innerHTML = "";
      groups.forEach(g => {
        const li = document.createElement("li");
        li.textContent = "ðŸ‘¥ " + g;
        li.onclick = () => openGroupChat(g);
        list.appendChild(li);
      });
    }
    function openGroupChat(group) {
      currentGroup = group;
      document.getElementById("activeGroupChat").classList.remove("hidden");
      document.getElementById("activeGroupTitle").textContent = "Group: " + group;
      showGroupMessages();
    }
    function sendGroupMessage() {
      if (!currentGroup) return;
      const text = document.getElementById("groupInput").value.trim();
      if (!text) return;
      const from = localStorage.getItem("loggedInUser");
      if (!groupChats[currentGroup]) groupChats[currentGroup] = [];
      groupChats[currentGroup].push({ from, text, time: new Date().toLocaleTimeString() });
      localStorage.setItem("groupChats", JSON.stringify(groupChats));
      document.getElementById("groupInput").value = "";
      showGroupMessages();
    }
    function showGroupMessages() {
      const box = document.getElementById("groupMessages");
      if (!currentGroup) return;
      const msgs = groupChats[currentGroup] || [];
      box.innerHTML = "";
      msgs.forEach(m => {
        const p = document.createElement("p");
        p.textContent = `[${m.time}] ${m.from}: ${m.text}`;
        box.appendChild(p);
      });
      box.scrollTop = box.scrollHeight;
    }

    // Sync across tabs
    window.addEventListener("storage", e => {
      if (e.key === "publicMessages") { publicMessages = JSON.parse(e.newValue) || []; showPublicMessages(); }
      if (e.key === "onlineUsers") { onlineUsers = JSON.parse(e.newValue) || []; showOnlineUsers(); }
      if (e.key === "privateChats") { privateChats = JSON.parse(e.newValue) || {}; if (currentDM) showPrivateMessages(); }
      if (e.key === "groups") { groups = JSON.parse(e.newValue) || []; showGroups(); }
      if (e.key === "groupChats") { groupChats = JSON.parse(e.newValue) || {}; if (currentGroup) showGroupMessages(); }
    });

    // Auto-login restore
    if (localStorage.getItem("loggedInUser")) {
      document.getElementById("currentUser").textContent = localStorage.getItem("loggedInUser");
      if (!onlineUsers.includes(localStorage.getItem("loggedInUser"))) {
        onlineUsers.push(localStorage.getItem("loggedInUser"));
        localStorage.setItem("onlineUsers", JSON.stringify(onlineUsers));
      }
      showMainContent();
    }
  </script>
</body>
</html>
